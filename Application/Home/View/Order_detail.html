 <style type="text/css">
 #bg{ display: none; position: absolute; top: 0%; left: 0%; width: 100%; height: 100%; background-color: black; z-index:1001; -moz-opacity: 0.7; opacity:.70; filter: alpha(opacity=70);}
  #show{display: none; position: absolute; top: 25%; left: 45%; padding: 8px; border: 8px solid #E8E9F7; background-color: white; z-index:1002; overflow: auto;}
 </style>
 <div id="bg" style="display:none;"></div>
    <div id="show" style="display:none;">
        <img src="__PUBLIC__/Admin/dist/img/loading.gif"><div align="center">正在加载...</div>
    </div>
<section class="content-header">
    <h1>
        订单详情管理
        <small></small>
    </h1>
</section>

<!-- Main content -->
<section class="content">
    <div class="row">
        <div class="col-md-12">
            <div class="box box-default">
                <div class="box-header with-border">
                    <h3 class="box-title">订单搜索</h3>
                </div>
                
                <if condition="$data.leave_status eq -1">
                    <form class="form-horizontal" action="{:U('Home/Order/detailSearch',array('leave_status'=>I('get.leave_status')))}" method="post">
                </if>
                <if condition="$data.retreat_status eq -1">
                    <form class="form-horizontal" action="{:U('Home/Order/detailSearch',array('retreat_status'=>I('get.retreat_status')))}" method="post">
                </if>
                <!--<form class="form-horizontal" action="{:U('Home/Order/detailSearch',array('leave_status'=>I('get.leave_status')))}" method="post">-->
                    <div class="box-body">
                        <div class="form-group">
                            <!--<label class="col-sm-1 control-label">商品</label>

                            <div class="col-sm-3">
                                <select name="product_id" class="form-control">
                                    <option value="-10">不选择商品</option>
                                    <volist name="productList" id="list">
                                        <option value="{$list.id}">{$list.name}</option>
                                    </volist>
                                </select>
                            </div>
                            
                            <label class="col-sm-1 control-label">订单编号</label>

                            <div class="col-sm-3">
                                <input class="form-control" name="orderid" placeholder="" value="{$orderPost.orderid}"
                                       type="text">
                            </div>-->

                            <label class="col-sm-1 control-label">用户名</label>

                            <div class="col-sm-3">
                                <input class="form-control" name="student_xsxm" placeholder="" value="{$orderPost.student_xsxm}"
                                       type="text">
                            </div>
                        </div>
                    </div>
                    

                    <div class="box-footer">
                        <div class="col-sm-2">
                            <button type="submit" class="btn btn-block btn-danger">开始搜索</button>
                        </div>
                    </div>
                </form>
            </div>
            
        </div>
        <!--/.col (right) -->
    </div>

    <div class="row">
        <!-- /.col -->
        <div class="col-md-12">
            <div class="box box-danger">
                <div class="box-header with-border">
                    <h3 class="box-title"><if condition="$data.leave_status eq -1">申请请假管理</if><if condition="$data.retreat_status eq -1">申请退餐管理</if></h3>
                    <!-- /.box-tools -->
                </div>
                <!-- /.box-header -->
                <div class="box-body no-padding">
                    <!--<div class="mailbox-controls">
                        <div class="btn-group">
                            <a href="{:U('Home/Order/export',array('status'=>I('get.status') , 'pay_status'=>I('get.pay_status') ,'day'=>I('get.day')))}"
                               target="_blank" class="btn btn-danger">
                                导出全部订单
                            </a>
                        </div>
                        
                    </div>

                    <div class="mailbox-controls">
                        <div class="btn-group">
                            <button type="button" class="btn btn-danger "
                                    onclick="batchUrl('{:U(\'Home/Order/wxPrint\')}')">打印
                            </button>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn btn-danger "
                                    onclick="batchUrl('{:U(\'Home/Order/update\',array(\'status\'=>1))}')">发货
                            </button>
                        </div>-->
                        <!--<div class="btn-group">-->
                            <!--<button type="button" class="btn btn-danger "-->
                                    <!--onclick="batchUrl('{:U(\'Home/Order/update\',array(\'pay_status\'=>1))}')">-->
                                <!--已支付-->
                            <!--</button>-->
                        <!--</div>-->
                        <!--<div class="btn-group">
                            <button type="button" class="btn btn-danger "
                                    onclick="batchUrl('{:U(\'Home/Order/update\',array(\'status\'=>-1))}')">取消
                            </button>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn btn-danger "
                                    onclick="batchUrl('{:U(\'Home/Order/update\',array(\'status\'=>2))}')">已完成
                            </button>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn btn-danger "
                                    onclick="batchUrl('{:U(\'Home/Order/update\',array(\'status\'=>-2))}')">退货中
                            </button>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn btn-danger "
                                    onclick="batchUrl('{:U(\'Home/Order/update\',array(\'status\'=>-3))}')">已退货
                            </button>
                        </div>
                        <div class="btn-group">
                            <button type="button" class="btn btn-danger "
                                    onclick="batchUrl('{:U(\'Home/Order/export\',array(\'status\'=>I(\'get.status\') , \'pay_status\'=>I(\'get.pay_status\') ,\'day\'=>I(\'get.day\')))}',false)">
                                导出订单
                            </button>
                        </div>--> 
                    </div>
                    <div class="table-responsive" style="overflow-x: visible;">
                        <table class="table table-bordered table-hover">
                            <tbody>
                            <tr>
                                <th class="hidden-xs">
                                    <label><input onchange="checkAll()" type="checkbox" value=""></label>
                                </th>
                                <th>订单编号</th>
                                <th>订单时间</th>
                                <th>商品时间</th>
                                <th>用户名</th>
                                <th>班级</th>
                                <th>商品名称</th>
                                <th>价格</th>
                                <th>申请时间</th>
                                <th><if condition="$data.leave_status eq -1">请假</if><if condition="$data.retreat_status eq -1">退餐</if>状态</th>
                                
                            </tr>
                            <volist name="orderdetailList" id="orderdetail">
                                <tr>
                                    <td class="hidden-xs">
                                        <label><input name="checkbox" class="check" type="checkbox" value="{$orderdetail.detail_id}"></label>
                                    </td>
                                    <td>
                                        <if condition="$orderdetail.orderid neq null">
                                            {$orderdetail.orderid}
                                        <else/>
                                            {$orderdetail.order.orderid}
                                        </if>
                                    </td>
                                    <td>
                                        {$orderdetail.time}
                                    </td>
                                    <td>
                                        {$orderdetail.product.order_date}
                                    </td>
                                    <td>
                                        {$orderdetail.student.xsxm}
                                    </td>
                                    <td>
                                        {$orderdetail.class.bjmc}
                                    </td>
                                    <td>
                                        {$orderdetail.name}
                                    </td>
                                    <td>
                                        <span style="background-color: #dd4b39;" class="badge">{$orderdetail.product.price}元</span>
                                    </td>
                                    <td>
                                        {$orderdetail.apply_time}
                                    </td>
                                    <td class="hidden-xs">
                                        <if condition="$data.leave_status eq -1">
                                            <if condition="$orderdetail.leave_status eq -1">
                                                <a class="ls" href="javascript:qingjia('{$orderdetail.detail_id}');">是</a> / <a class="ls" href="javascript:fqingjia('{$orderdetail.detail_id}');">否</a>
                                               
                                            </if>
                                        </if>
                                        <if condition="$data.retreat_status eq -1">
                                            <if condition="$orderdetail.retreat_status eq -1">
                                                <a href="javascript:tuican('{$orderdetail.detail_id}');">是</a> / <a href="javascript:rtuican('{$orderdetail.detail_id}');">否</a>
                                            </if>
                                        </if>
                                    </td>
                                    
                                </tr>
                            </volist>
                            </tbody>
                        </table>
                        <div class="box-footer no-padding">
                            <div class="mailbox-controls">
                                
                                <!-- /.btn-group -->
                                <div class="pull-right">
                                    {$page}
                                    <!-- /.btn-group -->
                                </div>
                                <!-- /.pull-right -->
                            </div>
                        </div>
                    </div>
                    <!-- /.mail-box-messages -->
                </div>
            </div>
            <!-- /. box -->
        </div>
        <!-- /.col -->
    </div> 
</section>
<script type="text/javascript">
    $(function () {
        $('#reservationtime').daterangepicker({
            timePicker: true,
            timePickerIncrement: 30,
            format: 'YYYY-MM-DD h:mm:ss',
            separator: ' --- ',
        });
        if ('{$orderPost}') {
            $('select[name="payment"]').val('{$orderPost.payment}');
            $('select[name="pay_status"]').val('{$orderPost.pay_status}');
            $('select[name="status"]').val('{$orderPost.status}');
            $('select[name="product_id"]').val('{$orderPost.product_id}');
        }
    });

    function qingjia(id){
        if(confirm("您要通过请假申请吗？")){
            $.ajax({
                url: "{:U(\'Home/Order/leaveyes\')}",
                type: 'post',
                data:  {id},
                beforeSend:function(){
                    //这里是开始执行方法，显示效果，效果自己写
                    document.getElementById("bg").style.display ="block";
                    document.getElementById("show").style.display ="block";
                },
                
                success:function(data){
                    //数据加载成功
                    document.getElementById("bg").style.display ="none";
                    document.getElementById("show").style.display ="none";
                    if(data == '1'){
                        window.location.reload();//刷新当前页面.                        
                    }else{
                        alert(data + '申请失败！');
                    }
                    
                }
            });
        }
    }

    function fqingjia(id){
        //输入拒绝申请理由
        var remark = prompt('请输入拒绝申请的理由：');
        //alert(remark);
        if(remark){
            $.post("{:U(\'Home/Order/leaveno\')}",{remark,id},function(data){
                window.location.reload();//刷新当前页面.
            })
        }
    }
    
    function tuican(id){
        if(confirm("您要通过退餐申请吗？")){
            $.ajax({
                url: "{:U(\'Home/Order/retreatyes\')}",
                type: 'post',
                data:  {id},
                beforeSend:function(){
                    //这里是开始执行方法，显示效果，效果自己写
                    document.getElementById("bg").style.display ="block";
                    document.getElementById("show").style.display ="block";
                },
                success:function(data){
                    //数据加载成功
                    document.getElementById("bg").style.display ="none";
                    document.getElementById("show").style.display ="none";
                    if(data == '1'){
                        window.location.reload();//刷新当前页面.                        
                    }else{
                        alert(data + '申请失败！');
                    }
                    
                }
            });
        }
    }
    function rtuican(id){
        //输入拒绝申请理由
        var remark = prompt('请输入拒绝申请的理由：');
        if(remark){
            $.post("{:U(\'Home/Order/retreatno\')}",{remark,id},function(data){
                window.location.reload();//刷新当前页面.
            })
        }
    }
</script>